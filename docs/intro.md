---
sidebar_position: 1
---

# 为什么我们需要 Yak 语言？

## 核心理念：垂直领域，安全融合

## 为什么要学习 Yak Language？

Yak 希望成为用户的第一门，也是最后一门安全测试专用语言。你可以用它来快速编写扫描器，进行安全扫描，集成调用任何第三方工具与接口。

> **大道至简**: 友善，简单的语法
>
> **站在巨人肩膀**: 封装集成优秀的安全工具，让安全工具成为语言的一部分
>
> **厚积薄发，长久积累**: 从一套企业级安全系统中发展独立而来
>
> **企业级解决方案**：具备久经沙场的分布式执行解决方案，大规模扫描变的可能

## 速览：像搭积木一样编写扫描工具

我们创建一个 `service_scan.yak` 内容如下

```go
// 极简获取参数，--target xxxx  --port 80
scanTarget, scanPorts = cli.String("target"), cli.String("port")

// 默认批量进行服务扫描
results, err = servicescan.Scan(scanTarget, scanPorts)
die(err)

// 取出扫描结果（异步扫描结果）
for result = range results {
    println(result.String())
}
```

于是我们执行 `yak service_scan.yak --target 192.168.1.1/24 --port 22,80` 之后，将会看到如下输出

```bash
tcp://192.168.1.32:22	 open	openssh[6.6.1]
tcp://192.168.1.21:22	 open	openssh[7.4]
tcp://192.168.1.40:22	 open	openssh[6.6.1]
tcp://192.168.1.43:22	 open	openssh[5.3]
tcp://192.168.1.44:22	 open	openssh[5.3]
tcp://192.168.1.46:22	 open	openssh[5.3]
tcp://192.168.1.60:22	 open	openssh[5.3]
tcp://192.168.1.48:22	 open	openssh[5.3]
tcp://192.168.1.66:22	 open	linux_kernel[*]/openssh[7.2p2]/ubuntu_linux[*]
tcp://192.168.1.80:22	 open	openssh[5.3]
...
...
...
...
...
tcp://192.168.1.83:80	 open	apache_tomcat[1.1]/coyote[1.1]/coyote_http_connector[1.1]/java[*]/jquery[*]/jquery[1.3.2]
tcp://192.168.1.99:80	 open
tcp://192.168.1.122:80	 open	nginx[*]
tcp://192.168.1.125:80	 open	linux_kernel[*]/nginx[1.10.3]/ubuntu[*]/ubuntu_linux[*]
tcp://192.168.1.126:80	 open	nginx[*]/php[5.4.45]
```

## 项目发展史

Yak 语言本身并不是一个凭空出现的项目。

### 从企业需求中诞生：合理的引擎需求

早在近两年，我在参与企业安全建设过程中，提出并实现了一套非常棒的企业安全平台架构，用来把所有的扫描能力，HIDS 源数据，数据处理能力，审计能力做了整合；
使得我们在同一个平台中，可以获取并同时以上帝视角分析这类数据，得到综合的安全分析的结论；但是由于数据纬度很多，我们编写一些基本的规则表现力并不够完成我们想要的分析。
所以，我们需要一个嵌入式语言。

甚至我们想把一些分析/规则能力

### 技术起源：嵌入式语言演变

如果是 Java 的话，这事儿很好解决，我们甚至有 `groovy` 等等表达式语言/嵌入式脚本语言去和代码进行无缝对接；但是由于技术栈的关系，我们并不能使用这些技术；
Golang 技术下可选的嵌入式语言并不算多。

经过一些技术调研之后，我选择了当时一个 `qiniu/qlang` 这个项目（原项目已不在维护，变成了 `Goplus`）。

> 感谢 @qiniu 的开源协议与精神。

虽然 `qiniu/qlang` 仍有很多 BUG，但是经过我一段时间耐心的修改和调教，实现了很多 `qlang` 未实现的功能，同时也解决了很多他作为嵌入式语言的问题，
终于可以初步把他应用在我的安全平台中了。

### 第一次露脸：[xray/rad 参与建设企业安全](https://mp.weixin.qq.com/s/eUbzDhebs5luMk64o2k1Pw)

当我们集成进平台中，效果其实非常棒，我们可以用它做太多事情了

1. 在文章中，我调用了 `xray/rad` 完成了漏洞扫描的一些能力；
1. 同时，基础的规则审计，报告生成，动态通知我们都用了这门神奇的嵌入式语言来参与我们的建设；

此时，我们已经完成了初步的："安全融合" 的概念，我们把能力和规则与平台进行了融合。

当然，虽然我们只融合了当时供职单位中的数据和安全能力，但是不可否认的是，这个"融合行为"，和 API 互相调用有着本质区别，在人力/研发资源不够的客观因素下，真的解决了太多的问题了

### 巅峰：分布式脚本执行引擎

